<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Density gating of intensity values in marker for each unique subset of subset_col — getDensityGates • staRgate</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Density gating of intensity values in marker for each unique subset of subset_col — getDensityGates"><meta name="description" content="For each unique value in subset_col, gate using density and estimated
derivatives to identify cutoff at shoulder (i.e., point of tapering off)
relative to the peak for marker (intensity values). The strategy of cutting
at the shoulder mimics the strategy to gate relative to a unimodal background
negative subpopulation, which is capable of capturing dim subpopulations."><meta property="og:description" content="For each unique value in subset_col, gate using density and estimated
derivatives to identify cutoff at shoulder (i.e., point of tapering off)
relative to the peak for marker (intensity values). The strategy of cutting
at the shoulder mimics the strategy to gate relative to a unimodal background
negative subpopulation, which is capable of capturing dim subpopulations."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">staRgate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/vignette_run_pipeline.html">Tutorial: Running the pipeline</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/leejasme/staRgate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Density gating of intensity values in <code>marker</code> for each unique subset of <code>subset_col</code></h1>
      <small class="dont-index">Source: <a href="https://github.com/leejasme/staRgate/blob/main/R/getDensityGates.R" class="external-link"><code>R/getDensityGates.R</code></a></small>
      <div class="d-none name"><code>getDensityGates.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>For each unique value in <code>subset_col</code>, gate using density and estimated
derivatives to identify cutoff at shoulder (i.e., point of tapering off)
relative to the peak for <code>marker</code> (intensity values). The strategy of cutting
at the shoulder mimics the strategy to gate relative to a unimodal background
negative subpopulation, which is capable of capturing dim subpopulations.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">getDensityGates</span><span class="op">(</span></span>
<span>  <span class="va">intens_dat</span>,</span>
<span>  <span class="va">marker</span>,</span>
<span>  <span class="va">subset_col</span>,</span>
<span>  bin_n <span class="op">=</span> <span class="fl">512</span>,</span>
<span>  peak_detect_ratio <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pos_peak_threshold <span class="op">=</span> <span class="fl">1800</span>,</span>
<span>  neg_intensity_threshold <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-intens-dat">intens_dat<a class="anchor" aria-label="anchor" href="#arg-intens-dat"></a></dt>
<dd><p>dataframe of pre-gated (compensated, biexp. transf,
openCyto steps) intensity values where
cols = intensity value per marker,
rows = each sample</p></dd>


<dt id="arg-marker">marker<a class="anchor" aria-label="anchor" href="#arg-marker"></a></dt>
<dd><p>string for the marker(s) to gate on
the names need to match exactly the column name in <code>intens_dat</code></p></dd>


<dt id="arg-subset-col">subset_col<a class="anchor" aria-label="anchor" href="#arg-subset-col"></a></dt>
<dd><p>string for the column name to indicate the subsets to apply
density gating on will perform operation on subsets
corresponding to each unique value in column</p></dd>


<dt id="arg-bin-n">bin_n<a class="anchor" aria-label="anchor" href="#arg-bin-n"></a></dt>
<dd><p>numeric to be passed to <code>n</code> parameter of <code>density(n = bin_n)</code>
for number of equally spaced points at which the density is to
be estimated <br>
Default is 512, which is the default of
<code>density(n = 512)</code></p></dd>


<dt id="arg-peak-detect-ratio">peak_detect_ratio<a class="anchor" aria-label="anchor" href="#arg-peak-detect-ratio"></a></dt>
<dd><p>numeric threshold for eliminating small peaks where
a peak that is &lt; than the highest peak by <code>peak_detect_ratio</code>
times will be ignored <br>
Default = 10</p></dd>


<dt id="arg-pos-peak-threshold">pos_peak_threshold<a class="anchor" aria-label="anchor" href="#arg-pos-peak-threshold"></a></dt>
<dd><p>either:</p><ul><li><p>numeric for threshold to identify a positive peak for all or</p></li>
<li><p>a dataframe if supplying multiple <code>marker</code> to gate. The dataframe
needs to be supplied with 2 columns named <code>marker</code> and
<code>pos_peak_threshold</code> and rows for the <code>marker</code> to gate</p></li>
</ul><p>Default is 1800 (note this is on the biexponential scale) for all <code>marker</code></p></dd>


<dt id="arg-neg-intensity-threshold">neg_intensity_threshold<a class="anchor" aria-label="anchor" href="#arg-neg-intensity-threshold"></a></dt>
<dd><p>numeric for threshold to filter out any
"very negatively" expressed cells in the density estimation to
avoid over-compression and difficulty in distinguishing peaks
and the gates <br>
This is only applied as a filter for the density estimation,
the cells &lt; <code>neg_intensity_threshold</code> are retained in the
intensity matrix for other steps <br>
Expects the <code>neg_intensity_threshold</code> is on the same scale as
the transformed data in <code>intens_dat</code> <br>
Default is <code>NULL</code>: no filters applied and density estimation
based on all cells in corresponding subsets.<br>
Suggested for biexp. transformed data is -1000 which corresponds
to ~-3300 on the original intensity scale)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>tibble of gates/cutoffs for <code>marker</code> for each unique subset found in
<code>subset_col</code> where</p><ul><li><p>rows correspond to unique values in <code>subset_col</code></p></li>
<li><p>, columns correspond to<code>marker</code></p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a fake dataset</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">intens_dat</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>               CD3_pos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               CD4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               CD8 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run density gating, leaving other params at suggested defaults</span></span></span>
<span class="r-in"><span><span class="co"># number of bins suggested is 40 but default is at `bin_n = 512`,</span></span></span>
<span class="r-in"><span><span class="co"># which is the default for the R base density() function</span></span></span>
<span class="r-in"><span><span class="fu">getDensityGates</span><span class="op">(</span><span class="va">intens_dat</span>, marker<span class="op">=</span><span class="st">"CD4"</span>, subset_col<span class="op">=</span><span class="st">"CD3_pos"</span>, bin_n<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   CD3_pos   CD4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>       0  88.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>       1 113. </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jasme Lee.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

