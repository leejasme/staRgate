<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="For each unique value in subset_col, gate using density and estimated derivatives
to identify cutoff at shoulder (i.e., point of tapering off) relative to the peak for
marker (intensity values). The strategy of cutting at the shoulder mimics the strategy
to gate relative to a unimodal background negative subpopulation, which is capable of
capturing dim subpopulations."><title>Density gating of intensity values in marker for each unique subset of subset_col — getDensityGates • staRgate</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Density gating of intensity values in marker for each unique subset of subset_col — getDensityGates"><meta property="og:description" content="For each unique value in subset_col, gate using density and estimated derivatives
to identify cutoff at shoulder (i.e., point of tapering off) relative to the peak for
marker (intensity values). The strategy of cutting at the shoulder mimics the strategy
to gate relative to a unimodal background negative subpopulation, which is capable of
capturing dim subpopulations."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">staRgate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette_run_pipeline.html">Tutorial: Running the pipeline</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/leejasme/staRgate/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Density gating of intensity values in <code>marker</code> for each unique subset of <code>subset_col</code></h1>
      <small class="dont-index">Source: <a href="https://github.com/leejasme/staRgate/blob/HEAD/R/getDensityGates.R" class="external-link"><code>R/getDensityGates.R</code></a></small>
      <div class="d-none name"><code>getDensityGates.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>For each unique value in <code>subset_col</code>, gate using density and estimated derivatives
to identify cutoff at shoulder (i.e., point of tapering off) relative to the peak for
<code>marker</code> (intensity values). The strategy of cutting at the shoulder mimics the strategy
to gate relative to a unimodal background negative subpopulation, which is capable of
capturing dim subpopulations.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">getDensityGates</span><span class="op">(</span></span>
<span>  <span class="va">intens_dat</span>,</span>
<span>  <span class="va">marker</span>,</span>
<span>  <span class="va">subset_col</span>,</span>
<span>  bin_n <span class="op">=</span> <span class="fl">512</span>,</span>
<span>  peak_detect_ratio <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pos_peak_threshold <span class="op">=</span> <span class="fl">1800</span>,</span>
<span>  neg_intensity_threshold <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>intens_dat</dt>
<dd><p>dataframe of pre-gated (compensated, biexp. transf, openCyto steps) intensity values where
cols = intensity value per marker,
rows = each sample</p></dd>


<dt>marker</dt>
<dd><p>string for the marker(s) to gate on
the names need to match exactly the column name in <code>intens_dat</code></p></dd>


<dt>subset_col</dt>
<dd><p>string for the column name to indicate the subsets to apply density gating on
will perform operation on subsets corresponding to each unique value in column</p></dd>


<dt>bin_n</dt>
<dd><p>numeric to be passed to <code>n</code> parameter of <code>density(n = bin_n)</code> for
number of equally spaced points at which the density is to be estimated
default is 512, which is the default of <code>density(n = 512)</code></p></dd>


<dt>peak_detect_ratio</dt>
<dd><p>numeric threshold for eliminating small peaks where
a peak that is &lt; than the highest peak by <code>peak_detect_ratio</code> times will be ignored
default = 10</p></dd>


<dt>pos_peak_threshold</dt>
<dd><p>either numeric for threshold to identify a positive peak for all or
a dataframe if supplying multiple <code>marker</code> to gate
Dataframe needs to be supplied with 2 columns named <code>marker</code> and <code>pos_peak_threshold</code>
and rows for the corresponding <code>marker</code> to gate
default is 1800 (note this is on the biexponential scale)</p></dd>


<dt>neg_intensity_threshold</dt>
<dd><p>numeric for threshold to filter out any "very negatively" expressed
cells in the density estimation to avoid over-compression and difficulty in distinguishing
peaks and the gates
This is only applied as a filter for the density estimation, the cells &lt; <code>neg_intensity_threshold`` are retained in the intensity matrix for other steps Expects the </code>neg_intensity_threshold<code>is on the same scale as the transformed data in</code>intens_dat<code>Default is</code>NULL`: no filters applied and density estimation based on all cells in
corresponding subsets.
Suggested for biexp. transformed data is -1000 which corresponds to ~-3300 on the original intensity scale)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>tibble of gates/cutoffs for <code>marker</code> for each unique subset found in <code>subset_col</code></p>


<p>rows correspond to unique values in <code>subset_col</code>, cols correspond to <code>marker</code></p>


    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#' library(dplyr)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a fake dataset</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">intens_dat</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>               CD3_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               CD4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               CD8 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run density gating, leaving other params at suggested defaults</span></span></span>
<span class="r-in"><span><span class="co"># number of bins suggested is 40 but default of the function is at `bin_n = 512`,</span></span></span>
<span class="r-in"><span><span class="co"># which is the default for the R base density() function</span></span></span>
<span class="r-in"><span><span class="fu">getDensityGates</span><span class="op">(</span><span class="va">intens_dat</span>, marker <span class="op">=</span> <span class="st">"CD4"</span>, susbet_col <span class="op">=</span> <span class="st">"CD3_pos"</span>, bin_n <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jasme Lee.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

